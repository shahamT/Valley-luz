import{g as se,S as oe,a as re,u as le,b as ie,c as de,d as ce,e as ue,f as he,_ as ve,h as ye,i as me}from"./CImTDOX4.js";import{u as H,M as Me,o as y,c as _,F as V,r as $,n as I,t as P,a as o,W as _e,b as h,H as Ce,d as fe,e as K,D as ge,f as pe,g as D,w as De,h as we,i as Se,j as be,k as xe,l as Ee,m as L,p as ke,q as Oe,s as Te,v as N,x as W,y as O,z as k,A as x,B,C as R,E as j,G as E,I as q,J as Ie,K as Pe,L as Re,U as z,N as F,O as U,_ as Ve,P as $e}from"./C0e_lt4H.js";const Ne={class:"WeekdayRow"},We=Object.assign({name:"WeekdayRow"},{__name:"WeekdayRow",setup(r){const n=H(Me),i=h(()=>n.value?Ce:fe),C=l=>_e.includes(l);return(l,a)=>(y(),_("div",Ne,[(y(!0),_(V,null,$(o(i),(m,v)=>(y(),_("div",{key:m,class:I(["WeekdayRow-day",{"WeekdayRow-day--weekend":C(v)}])},P(m),3))),128))]))}}),Ye={class:"DayCell-number"},Ae={key:0,class:"DayCell-events"},Le=Object.assign({name:"DayCell"},{__name:"DayCell",props:{day:{type:Object,required:!0}},setup(r){const n=r,{categories:i}=K(),C=H(ge),l=h(()=>!n.day.isOutsideMonth&&n.day.dateString<L()),a=h(()=>!n.day.isOutsideMonth&&n.day.dateString===L()),m=h(()=>n.day.isOutsideMonth||n.day.eventsCount===0?[]:ke(n.day.events,n.day.eventsCount)),v=h(()=>Oe(n.day.eventsCount)),d=h(()=>n.day.isOutsideMonth?!1:Te(n.day.dateString)),f=()=>{n.day.isOutsideMonth||l.value||Ee(`/daily-view/${n.day.dateString}`)},w=p=>be(p,i.value),g=()=>xe(v.value,C.value);return(p,c)=>{const e=pe("tooltip");return y(),_("div",{class:I(["DayCell",{"DayCell--outside":r.day.isOutsideMonth,"DayCell--past":o(l),"DayCell--today":o(a),"DayCell--no-events":r.day.eventsCount===0&&!r.day.isOutsideMonth&&!o(l),"DayCell--weekend":o(d)&&!r.day.isOutsideMonth}]),onClick:c[0]||(c[0]=t=>!r.day.isOutsideMonth&&!o(l)&&f())},[D("div",Ye,P(r.day.dayNumber),1),!r.day.isOutsideMonth&&r.day.eventsCount>0?(y(),_("div",Ae,[(y(!0),_(V,null,$(o(m),(t,u)=>De((y(),_("div",{key:t.id||u,class:I(["DayCell-chip",{"DayCell-chip--more":t.isMore}]),style:we(t.isMore?{}:{backgroundColor:w(t.mainCategory)})},[D("span",{class:I(["DayCell-chipText",{"DayCell-chipText--more":t.isMore}])},P(t.isMore?g():t.title||""),3)],6)),[[e,t.isMore?void 0:t.title||""]])),128))])):Se("",!0)],2)}}});function Be(r,n,i={},C={}){const l=[],a=new Date(r,n-1,1),v=new Date(r,n,0).getDate(),d=a.getDay(),f=new Date(r,n-1,0).getDate();let w=0;for(let c=d-1;c>=0;c--){const e=f-c,t=new Date(r,n-2,e);l.push({dayNumber:e,isOutsideMonth:!0,eventsCount:0,dateString:N(t),events:[]}),w++}for(let c=1;c<=v;c++){const e=new Date(r,n-1,c),t=N(e);l.push({dayNumber:c,isOutsideMonth:!1,eventsCount:i[t]||0,dateString:t,events:C[t]||[]})}const g=w+v,p=g%W===0?0:W-g%W;for(let c=1;c<=p;c++){const e=new Date(r,n,c);l.push({dayNumber:c,isOutsideMonth:!0,eventsCount:0,dateString:N(e),events:[]})}return l}const je={class:"MonthCalendar"},qe={class:"MonthCalendar-weekdays"},ze={class:"MonthCalendar-gridWrapper"},Fe={class:"MonthCalendar-grid"},Ue=Object.assign({name:"MonthCalendar"},{__name:"MonthCalendar",props:{date:{type:Object,default:()=>x()},events:{type:Array,required:!0}},setup(r){const n=r,i=h(()=>se(n.events,n.date.year,n.date.month)),C=h(()=>{const a={};for(const[m,v]of Object.entries(i.value))a[m]=v.length;return a}),l=h(()=>Be(n.date.year,n.date.month,C.value,i.value));return(a,m)=>{const v=We,d=Le;return y(),_("div",je,[D("div",qe,[O(v)]),D("div",ze,[D("div",Fe,[(y(!0),_(V,null,$(o(l),f=>(y(),k(d,{key:f.dateString,day:f},null,8,["day"]))),128))])])])}}}),He={class:"MonthCarousel"},Ke=Object.assign({name:"MonthCarousel"},{__name:"MonthCarousel",props:{visibleMonths:{type:Array,required:!0},currentDate:{type:Object,required:!0},filteredEvents:{type:Array,default:()=>[]},todayMonth:{type:Object,required:!0},slideToMonthRequest:{type:Object,default:null}},emits:["month-change"],setup(r,{emit:n}){const i=r,C=n,l=E(null),a=E(null),m=E(1),v=E(!1),d=h(()=>i.visibleMonths.findIndex(e=>!j(e,i.todayMonth))),f=h(()=>d.value>=0&&m.value>d.value),w={touchStart(e){const t=d.value>=0&&e.activeIndex>d.value;e.allowSlidePrev=t,e.params.allowSlidePrev=t}},g=e=>{a.value=e,m.value=e.activeIndex;const t=d.value>=0&&e.activeIndex>d.value;e.allowSlidePrev=t,e.params.allowSlidePrev=t},p=e=>{const t=e.activeIndex,u=i.visibleMonths[t];if(!v.value&&u&&j(u,i.todayMonth)&&d.value>=0){e.slideTo(d.value);return}const M=d.value>=0&&t>d.value;e.allowSlidePrev=M,e.params.allowSlidePrev=M},c=e=>{const t=e.activeIndex,u=i.visibleMonths[t],M=v.value;v.value=!1,m.value=t,u&&!M&&C("month-change",{year:u.year,month:u.month});const b=d.value>=0&&t>d.value;e.allowSlidePrev=b,e.params.allowSlidePrev=b};return B(()=>i.currentDate,()=>{const e=a.value;if(!e)return;const t=i.visibleMonths.findIndex(u=>q(u,i.currentDate));t>=0&&t!==e.activeIndex&&(v.value=!0,e.slideTo(t,0))}),B(()=>i.slideToMonthRequest,e=>{if(!e)return;const t=a.value;if(!t)return;const u=i.visibleMonths.findIndex(M=>q(M,e));u>=0&&u!==t.activeIndex&&t.slideTo(u)}),(e,t)=>{const u=Ue;return y(),_("section",He,[O(o(re),{ref_key:"swiperRef",ref:l,"slides-per-view":1,"space-between":0,"centered-slides":!0,speed:600,"allow-touch-move":!0,resistance:!0,"resistance-ratio":0,dir:"rtl","initial-slide":1,"allow-slide-prev":o(f),on:w,onSwiper:g,onSlideChange:p,onSlideChangeTransitionEnd:c,class:"MonthCarousel-swiper"},{default:R(()=>[(y(!0),_(V,null,$(r.visibleMonths,M=>(y(),k(o(oe),{key:`${M.year}-${M.month}`,class:"MonthCarousel-slide"},{default:R(()=>[O(u,{date:M,events:r.filteredEvents},null,8,["date","events"])]),_:2},1024))),128))]),_:1},8,["allow-slide-prev"])])}}}),Ge={class:"MonthlyView"},Je={class:"MonthlyView-header"},Xe={class:"MonthlyView-calendar"},Qe={key:1,class:"MonthlyView-error"},tt={__name:"index",setup(r){le({title:"יומן Valley Luz - תצוגה חודשית"}),ie({description:"יומן אירועים חודשי של Valley Luz - צפייה בכל האירועים והפעילויות החודשיות",ogTitle:"יומן Valley Luz - תצוגה חודשית",ogDescription:"יומן אירועים חודשי של Valley Luz"});const{events:n,isLoading:i,isError:C}=K(),l=de(),{currentDate:a}=Ie(l),m=Pe(),{getFilteredEventsForMonth:v}=ce(n),{switchToDailyView:d}=ue(),{initializeFromUrl:f,startUrlSync:w}=he({syncMonth:!0});Re(()=>{f(),w(),m.initializeModalFromUrl()});const g=h(()=>a.value?.year??x().year),p=h(()=>a.value?.month??x().month),c=h(()=>$e(g.value,p.value)),e=h(()=>{const s=new Date,S=a.value;return S&&S.year===s.getFullYear()&&S.month===s.getMonth()+1}),t=h(()=>x()),u=h(()=>{const s=a.value??x();return!s?.year||!s?.month?[]:[U(s.year,s.month),{year:s.year,month:s.month},F(s.year,s.month)]}),M=E(null),b=s=>{u.value.some(T=>T.year===s.year&&T.month===s.month)?M.value=s:l.setCurrentDate(s)},Y=()=>{b(U(a.value.year,a.value.month))},A=()=>{b(F(a.value.year,a.value.month))},G=s=>{l.setCurrentDate(s),M.value=null},J=({year:s,month:S})=>{l.setCurrentDate({year:s,month:S})},X=({year:s})=>{l.setCurrentDate({...a.value,year:s})},Q=({view:s})=>{s==="day"&&d(a.value)},Z=h(()=>v(g.value,p.value));return(s,S)=>{const T=ve,ee=me,te=Ke,ne=ye,ae=Ve;return y(),k(ae,null,{default:R(()=>[D("div",Ge,[D("div",Je,[O(T,{"view-mode":"month","month-year":o(c),"current-date":o(a),"prev-disabled":o(e),"prev-aria-label":"Previous month","next-aria-label":"Next month",onSelectMonthYear:J,onYearChange:X,onViewChange:Q,onPrev:Y,onNext:A},null,8,["month-year","current-date","prev-disabled"])]),D("div",Xe,[O(ne,{"view-mode":"month","prev-disabled":o(e),"prev-aria-label":"Previous month","next-aria-label":"Next month",onPrev:Y,onNext:A},{month:R(()=>[o(i)&&!o(n)?.length?(y(),k(ee,{key:0,message:o(z).loading},null,8,["message"])):o(C)?(y(),_("div",Qe,[D("p",null,P(o(z).error),1)])):(y(),k(te,{key:2,"visible-months":o(u),"current-date":o(a),"filtered-events":o(Z),"today-month":o(t),"slide-to-month-request":o(M),onMonthChange:G},null,8,["visible-months","current-date","filtered-events","today-month","slide-to-month-request"]))]),_:1},8,["prev-disabled"])])])]),_:1})}}};export{tt as default};
