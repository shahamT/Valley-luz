import{u as H,g as ne,a as ae,b as A,c as se,d as oe,i as re,f as W,e as x,h as B,S as le,j as ie,k as L,l as de,m as ce,n as ue,o as he,p as ve,q as ye,_ as me,r as Me,s as Ce,t as q,v as j,w as _e}from"./CS5ACRjG.js";import{u as K,M as fe,o as y,c as g,F as $,r as N,n as V,t as P,a as o,b as h,H as ge,d as pe,D as De,e as w,f as we,g as Se,h as be,i as T,j as I,w as F,k as R,l as k,s as Ee,m as xe,_ as ke}from"./CoydzPQz.js";import{W as Ie,D as Y,U as z}from"./B3v3fkZ5.js";const Te={class:"WeekdayRow"},Oe={__name:"WeekdayRow",setup(s){const t=K(fe),C=h(()=>t.value?ge:pe),d=r=>Ie.includes(r);return(r,c)=>(y(),g("div",Te,[(y(!0),g($,null,N(o(C),(_,m)=>(y(),g("div",{key:_,class:V(["WeekdayRow-day",{"WeekdayRow-day--weekend":d(m)}])},P(_),3))),128))]))}},Ve={class:"DayCell-number"},Pe={key:0,class:"DayCell-events"},Re=Object.assign({name:"DayCell"},{__name:"DayCell",props:{day:{type:Object,required:!0}},setup(s){const t=s,{categories:C}=H(),d=K(De),r=h(()=>!t.day.isOutsideMonth&&t.day.dateString<A()),c=h(()=>!t.day.isOutsideMonth&&t.day.dateString===A()),_=h(()=>t.day.isOutsideMonth||t.day.eventsCount===0?[]:se(t.day.events,t.day.eventsCount)),m=h(()=>oe(t.day.eventsCount)),f=h(()=>t.day.isOutsideMonth?!1:re(t.day.dateString)),l=()=>{t.day.eventsCount>0&&be(`/daily-view/${t.day.dateString}`)},p=S=>ne(S,C.value),D=()=>ae(m.value,d.value);return(S,i)=>(y(),g("div",{class:V(["DayCell",{"DayCell--outside":s.day.isOutsideMonth,"DayCell--past":o(r),"DayCell--today":o(c),"DayCell--no-events":s.day.eventsCount===0&&!s.day.isOutsideMonth&&!o(r),"DayCell--weekend":o(f)&&!s.day.isOutsideMonth}]),onClick:i[0]||(i[0]=u=>!s.day.isOutsideMonth&&!o(r)&&l())},[w("div",Ve,P(s.day.dayNumber),1),!s.day.isOutsideMonth&&s.day.eventsCount>0?(y(),g("div",Pe,[(y(!0),g($,null,N(o(_),(u,e)=>(y(),g("div",{key:u.id||e,class:V(["DayCell-chip",{"DayCell-chip--more":u.isMore}]),style:we(u.isMore?{}:{backgroundColor:p(u.mainCategory)})},[w("span",{class:V(["DayCell-chipText",{"DayCell-chipText--more":u.isMore}])},P(u.isMore?D():u.title||""),3)],6))),128))])):Se("",!0)],2))}});function $e(s,t,C={},d={}){const r=[],c=new Date(s,t-1,1),m=new Date(s,t,0).getDate(),f=c.getDay(),l=new Date(s,t-1,0).getDate();let p=0;for(let i=f-1;i>=0;i--){const u=l-i,e=new Date(s,t-2,u);r.push({dayNumber:u,isOutsideMonth:!0,eventsCount:0,dateString:W(e),events:[]}),p++}for(let i=1;i<=m;i++){const u=new Date(s,t-1,i),e=W(u);r.push({dayNumber:i,isOutsideMonth:!1,eventsCount:C[e]||0,dateString:e,events:d[e]||[]})}const D=p+m,S=D%Y===0?0:Y-D%Y;for(let i=1;i<=S;i++){const u=new Date(s,t,i);r.push({dayNumber:i,isOutsideMonth:!0,eventsCount:0,dateString:W(u),events:[]})}return r}const Ne={class:"MonthCalendar"},We={class:"MonthCalendar-weekdays"},Ye={class:"MonthCalendar-gridWrapper"},Ae={class:"MonthCalendar-grid"},Be={__name:"MonthCalendar",props:{date:{type:Object,default:()=>x()},events:{type:Array,required:!0}},setup(s){const t=s,C=h(()=>B.getEventCountsByDate(t.events,t.date.year,t.date.month)),d=h(()=>B.getEventsByDate(t.events,t.date.year,t.date.month)),r=h(()=>$e(t.date.year,t.date.month,C.value,d.value));return(c,_)=>{const m=Oe,f=Re;return y(),g("div",Ne,[w("div",We,[T(m)]),w("div",Ye,[w("div",Ae,[(y(!0),g($,null,N(o(r),l=>(y(),I(f,{key:l.dateString,day:l},null,8,["day"]))),128))])])])}}},Le={class:"MonthCarousel"},qe={__name:"MonthCarousel",props:{visibleMonths:{type:Array,required:!0},currentDate:{type:Object,required:!0},filteredEvents:{type:Array,default:()=>[]},todayMonth:{type:Object,required:!0},slideToMonthRequest:{type:Object,default:null}},emits:["month-change"],setup(s,{emit:t}){function C(e,n){return e&&n&&e.year===n.year&&e.month===n.month}const d=s,r=t,c=k(null),_=k(null),m=k(1),f=k(!1),l=h(()=>d.visibleMonths.findIndex(e=>!L(e,d.todayMonth))),p=h(()=>l.value>=0&&m.value>l.value),D={touchStart(e){const n=l.value>=0&&e.activeIndex>l.value;e.allowSlidePrev=n,e.params.allowSlidePrev=n}},S=e=>{_.value=e,m.value=e.activeIndex;const n=l.value>=0&&e.activeIndex>l.value;e.allowSlidePrev=n,e.params.allowSlidePrev=n},i=e=>{const n=e.activeIndex,v=d.visibleMonths[n];if(!f.value&&v&&L(v,d.todayMonth)&&l.value>=0){e.slideTo(l.value);return}const M=l.value>=0&&n>l.value;e.allowSlidePrev=M,e.params.allowSlidePrev=M},u=e=>{const n=e.activeIndex,v=d.visibleMonths[n],M=f.value;f.value=!1,m.value=n,v&&!M&&r("month-change",{year:v.year,month:v.month});const O=l.value>=0&&n>l.value;e.allowSlidePrev=O,e.params.allowSlidePrev=O};return F(()=>d.currentDate,()=>{const e=_.value;if(!e)return;const n=d.visibleMonths.findIndex(v=>C(v,d.currentDate));n>=0&&n!==e.activeIndex&&(f.value=!0,e.slideTo(n,0))}),F(()=>d.slideToMonthRequest,e=>{if(!e)return;const n=_.value;if(!n)return;const v=d.visibleMonths.findIndex(M=>C(M,e));v>=0&&v!==n.activeIndex&&n.slideTo(v)}),(e,n)=>{const v=Be;return y(),g("section",Le,[T(o(ie),{ref_key:"swiperRef",ref:c,"slides-per-view":1,"space-between":0,"centered-slides":!0,speed:600,"allow-touch-move":!0,resistance:!0,"resistance-ratio":0,dir:"rtl","initial-slide":1,"allow-slide-prev":p.value,on:D,onSwiper:S,onSlideChange:i,onSlideChangeTransitionEnd:u,class:"MonthCarousel-swiper"},{default:R(()=>[(y(!0),g($,null,N(s.visibleMonths,M=>(y(),I(o(le),{key:`${M.year}-${M.month}`,class:"MonthCarousel-slide"},{default:R(()=>[T(v,{date:M,events:s.filteredEvents},null,8,["date","events"])]),_:2},1024))),128))]),_:1},8,["allow-slide-prev"])])}}},je={class:"MonthlyView"},Fe={class:"MonthlyView-header"},ze={class:"MonthlyView-calendar"},He={key:1,class:"MonthlyView-error"},Ge={__name:"index",setup(s){de({title:"יומן Valley Luz - תצוגה חודשית"}),ce({description:"יומן אירועים חודשי של Valley Luz - צפייה בכל האירועים והפעילויות החודשיות",ogTitle:"יומן Valley Luz - תצוגה חודשית",ogDescription:"יומן אירועים חודשי של Valley Luz"});const{events:t,isLoading:C,isError:d}=H(),r=ue(),{currentDate:c}=Ee(r),{getFilteredEventsForMonth:_}=he(t),{switchToDailyView:m}=ve(),{initializeFromUrl:f,startUrlSync:l}=ye({syncMonth:!0});xe(()=>{f(),l()});const p=h(()=>c.value?.year??x().year),D=h(()=>c.value?.month??x().month),S=h(()=>_e(p.value,D.value)),i=h(()=>{if(typeof window>"u")return!1;const a=new Date,b=c.value;return b&&b.year===a.getFullYear()&&b.month===a.getMonth()+1}),u=h(()=>x()),e=h(()=>{const a=c.value??x();return!a?.year||!a?.month?[]:[j(a.year,a.month),{year:a.year,month:a.month},q(a.year,a.month)]}),n=k(null),v=()=>{const a=j(c.value.year,c.value.month);e.value.some(E=>E.year===a.year&&E.month===a.month)?n.value=a:r.setCurrentDate(a)},M=()=>{const a=q(c.value.year,c.value.month);e.value.some(E=>E.year===a.year&&E.month===a.month)?n.value=a:r.setCurrentDate(a)},O=a=>{r.setCurrentDate(a),n.value=null},U=({year:a,month:b})=>{r.setCurrentDate({year:a,month:b})},X=({year:a})=>{r.setCurrentDate({...c.value,year:a})},G=({view:a})=>{a==="day"&&m(c.value)},J=h(()=>_(p.value,D.value));return(a,b)=>{const E=me,Q=Ce,Z=qe,ee=Me,te=ke;return y(),I(te,{"show-month-year":!1},{default:R(()=>[w("div",je,[w("div",Fe,[T(E,{"view-mode":"month","month-year":o(S),"current-date":o(c),"prev-disabled":o(i),"prev-aria-label":"Previous month","next-aria-label":"Next month",onSelectMonthYear:U,onYearChange:X,onViewChange:G,onPrev:v,onNext:M},null,8,["month-year","current-date","prev-disabled"])]),w("div",ze,[T(ee,{"view-mode":"month","prev-disabled":o(i),"prev-aria-label":"Previous month","next-aria-label":"Next month",onPrev:v,onNext:M},{month:R(()=>[o(C)&&!o(t)?.length?(y(),I(Q,{key:0,message:o(z).loading},null,8,["message"])):o(d)?(y(),g("div",He,[w("p",null,P(o(z).error),1)])):(y(),I(Z,{key:2,"visible-months":o(e),"current-date":o(c),"filtered-events":o(J),"today-month":o(u),"slide-to-month-request":o(n),onMonthChange:O},null,8,["visible-months","current-date","filtered-events","today-month","slide-to-month-request"]))]),_:1},8,["prev-disabled"])])])]),_:1})}}};export{Ge as default};
