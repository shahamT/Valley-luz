import{s as ue,S as ve,d as ye,j as me,k as he,l as _e,m as Ce,t as H,u as be,h as ge,_ as pe,n as De,o as fe,g as R,v as L,r as G,f as we}from"./Odd95hdQ.js";import{d as W,B as Z,o as u,c as C,f as d,g as X,a as s,t as p,s as $,E as Se,F as z,r as A,n as ee,h as ae,b as c,i as J,v as E,U,x as q,y as M,z as V,G as xe,C as Ke,H as Ee,k as P,_ as $e,I as Q}from"./CScE6ojO.js";const Ie={class:"KanbanEventCard-body"},Te={class:"KanbanEventCard-time"},ke={class:"KanbanEventCard-content"},Pe={class:"KanbanEventCard-title"},Ve={class:"KanbanEventCard-locationChip"},Me={class:"KanbanEventCard-locationChipText"},Be={class:"KanbanEventCard-desc"},Ye={key:0,class:"KanbanEventCard-chips"},Ne=Object.assign({name:"KanbanEventCard"},{__name:"KanbanEventCard",props:{event:{type:Object,required:!0}},setup(r){const m=r,{categories:_}=W(),o=Z(),D=c(()=>J(m.event.mainCategory,_.value)),f=c(()=>{const n=m.event.mainCategory,g=m.event.categories??[];if(!n&&!g.length)return[];const w=g.filter(v=>v!==n);return n?[n,...w]:g}),h=c(()=>{const n=f.value;return n.length===0?[]:n.length===1?[{id:n[0]}]:n.length===2?[{id:n[0]},{id:n[1]}]:[{id:n[0]},{id:n[1]},{isMore:!0,count:n.length-2}]}),b=n=>J(n,_.value),K=n=>_.value?.[n]?.label??n,i=()=>{o.openEventModal(m.event.eventId)};return(n,g)=>{const w=Se;return u(),C("div",{class:"KanbanEventCard",onClick:i},[d("div",{class:"KanbanEventCard-accent",style:X({backgroundColor:s(D)})},null,4),d("div",Ie,[d("div",Te,p(r.event.timeText),1),d("div",ke,[d("h3",Pe,p(r.event.title),1),d("div",Ve,[$(w,{name:"location_on",size:"xs",class:"KanbanEventCard-locationChipIcon"}),d("span",Me,p(r.event.locationDisplay),1)]),d("p",Be,p(r.event.shortDescription||r.event.desc),1)]),s(h).length?(u(),C("div",Ye,[(u(!0),C(z,null,A(s(h),v=>(u(),C("span",{key:v.id??`more-${v.count}`,class:ee(["KanbanEventCard-chip",{"KanbanEventCard-chip--more":v.isMore}]),style:X(v.isMore?{}:{backgroundColor:b(v.id)})},p(v.isMore?`+${v.count}`:K(v.id)),7))),128))])):ae("",!0)])])}}}),Re={class:"KanbanColumn-header"},Le={class:"KanbanColumn-title"},Ue={class:"KanbanColumn-events"},qe={class:"KanbanColumn-events-inner"},ze={key:0,class:"KanbanColumn-empty"},Ae=Object.assign({name:"KanbanColumn"},{__name:"KanbanColumn",props:{date:{type:String,required:!0},events:{type:Array,default:()=>[]},isDisabled:{type:Boolean,default:!1}},setup(r){const m=r,_=c(()=>ue(m.date));return(o,D)=>{const f=Ne;return u(),C("div",{class:ee(["KanbanColumn",{"KanbanColumn--disabled":r.isDisabled}])},[d("div",Re,[d("h2",Le,p(s(_)),1)]),d("div",Ue,[d("div",qe,[(u(!0),C(z,null,A(r.events,h=>(u(),E(f,{key:h.id,event:h},null,8,["event"]))),128)),r.events.length===0?(u(),C("div",ze,p(s(U).noEvents),1)):ae("",!0)])])],2)}}}),Fe={class:"KanbanCarousel"},Oe=3,je=24,He={__name:"KanbanCarousel",props:{visibleDays:{type:Array,required:!0},eventsByDate:{type:Object,required:!0},currentDate:{type:String,required:!0},today:{type:String,required:!0},slideToDateRequest:{type:String,default:null}},emits:["date-change"],setup(r,{emit:m}){const _={0:{slidesPerView:"auto",spaceBetween:16,centeredSlides:!0,centeredSlidesBounds:!0},769:{slidesPerView:3,spaceBetween:24}},o=r,D=m,f=V(null),h=V(null),b=V(0),K=c(()=>{const e=o.visibleDays.findIndex(t=>t===o.currentDate);return e>=0?e:5}),i=c(()=>o.visibleDays.findIndex(e=>e>=o.today)),n=e=>e<o.today,g=c(()=>i.value>=0&&b.value>i.value),w={touchStart(e){const t=i.value>=0&&e.activeIndex>i.value;e.allowSlidePrev=t,e.params.allowSlidePrev=t}},v=e=>{h.value=e,b.value=e.activeIndex;const t=i.value>=0&&e.activeIndex>i.value;e.allowSlidePrev=t,e.params.allowSlidePrev=t},B=e=>{const t=e.activeIndex;if(o.visibleDays[t]<o.today&&i.value>=0){e.slideTo(i.value);return}const y=i.value>=0&&t>i.value;e.allowSlidePrev=y,e.params.allowSlidePrev=y},Y=e=>{const t=e.activeIndex,l=o.visibleDays[t];b.value=t,l&&D("date-change",l);const y=i.value>=0&&t>i.value;e.allowSlidePrev=y,e.params.allowSlidePrev=y};return q(()=>o.currentDate,()=>{const e=h.value;if(!e)return;const t=o.visibleDays.findIndex(l=>l===o.currentDate);t>=0&&t!==e.activeIndex&&e.slideTo(t)}),q(()=>o.slideToDateRequest,e=>{if(!e||!o.visibleDays.includes(e))return;const t=h.value;if(!t)return;const l=o.visibleDays.findIndex(y=>y===e);l>=0&&l!==t.activeIndex&&t.slideTo(l)}),(e,t)=>{const l=Ae;return u(),C("section",Fe,[$(s(ye),{ref_key:"swiperRef",ref:f,"slides-per-view":Oe,"space-between":je,"centered-slides":!0,speed:600,"allow-touch-move":!0,resistance:!0,"resistance-ratio":0,dir:"rtl","initial-slide":s(K),"allow-slide-prev":s(g),on:w,onSwiper:v,onSlideChange:B,onSlideChangeTransitionEnd:Y,breakpoints:_,class:"KanbanCarousel-swiper"},{default:M(()=>[(u(!0),C(z,null,A(r.visibleDays,y=>(u(),E(s(ve),{key:y,class:"KanbanCarousel-slide"},{default:M(()=>[$(l,{date:y,events:r.eventsByDate[y]||[],"is-disabled":n(y)},null,8,["date","events","is-disabled"])]),_:2},1024))),128))]),_:1},8,["initial-slide","allow-slide-prev"])])}}},Ge={class:"DailyView"},Xe={class:"DailyView-header"},Je={class:"DailyView-content"},Qe={key:1,class:"DailyView-error"},ea={__name:"[date]",async setup(r){let m,_;const o=xe(),{events:D,isLoading:f,isError:h}=W(),b=me(),K=Z(),{getFilteredEventsByDate:i}=he(D),{navigateToMonth:n,navigateToMonthInDailyView:g,goToPrevDay:w,goToNextDay:v}=_e(),{initializeFromUrl:B,startUrlSync:Y}=Ce({syncMonth:!1});Ke(()=>{B(),Y(),K.initializeModalFromUrl()}),o.params.date&&!H(o.params.date)&&([m,_]=Ee(()=>P(`/daily-view/${R()}`,{replace:!0})),await m,_());const e=c(()=>{const a=o.params.date;return a&&H(a)?a:R()}),t=c(()=>{const a=L(e.value),S=a.getDate(),x=G(a.getFullYear(),a.getMonth()+1);return`יומן Valley Luz - ${S} ${x}`});be({title:t}),ge({description:"תצוגה יומית של אירועים ופעילויות ב-Valley Luz",ogTitle:t,ogDescription:"תצוגה יומית של אירועים ב-Valley Luz"});const l=c(()=>{const a=L(e.value);return{year:a.getFullYear(),month:a.getMonth()+1}});q(l,a=>{b.setCurrentDate(a)},{immediate:!0});const y=c(()=>G(l.value.year,l.value.month)),I=c(()=>{const a=L(e.value),S=[];for(let x=-Q;x<=Q;x++){const k=new Date(a);k.setDate(a.getDate()+x),S.push(we(k))}return S}),F=c(()=>R()),T=V(null),N=c(()=>e.value<=F.value),O=()=>{if(N.value)return;const a=w(e.value);I.value.includes(a)?T.value=a:P(`/daily-view/${a}`)},j=()=>{const a=v(e.value);I.value.includes(a)?T.value=a:P(`/daily-view/${a}`)},te=c(()=>i(I.value)),ne=({year:a,month:S})=>{g(a,S)},se=({year:a})=>{b.setCurrentDate({year:a,month:l.value.month})},oe=a=>{P(`/daily-view/${a}`),T.value=null},le=()=>{n(l.value.year,l.value.month)},re=({view:a})=>{a==="month"&&le()};return(a,S)=>{const x=pe,k=fe,ie=He,de=De,ce=$e;return u(),E(ce,null,{default:M(()=>[d("div",Ge,[d("div",Xe,[$(x,{"view-mode":"day","month-year":s(y),"current-date":s(l),"prev-disabled":s(N),"prev-aria-label":"Previous day","next-aria-label":"Next day",onSelectMonthYear:ne,onYearChange:se,onViewChange:re,onPrev:O,onNext:j},null,8,["month-year","current-date","prev-disabled"])]),d("div",Je,[$(de,{"view-mode":"day","prev-disabled":s(N),"prev-aria-label":"Previous day","next-aria-label":"Next day",onPrev:O,onNext:j},{day:M(()=>[s(f)&&!s(D)?.length?(u(),E(k,{key:0,message:s(U).loading},null,8,["message"])):s(h)?(u(),C("div",Qe,[d("p",null,p(s(U).error),1)])):(u(),E(ie,{key:2,"visible-days":s(I),"events-by-date":s(te),"current-date":s(e),today:s(F),"slide-to-date-request":s(T),onDateChange:oe},null,8,["visible-days","events-by-date","current-date","today","slide-to-date-request"]))]),_:1},8,["prev-disabled"])])])]),_:1})}}};export{ea as default};
